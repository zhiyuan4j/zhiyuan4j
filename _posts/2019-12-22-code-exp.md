---
layout: post
title:  编程经验
excerpt: "总结总结一些编码的经验"
categories: [experience]
commnet: true
---


# 高内聚，低耦合

在学校刚学java时，就老是在念叨，面向对象，高内聚，低耦合。  

初学的感觉就是，代码写哪都一样，反正功能实现了就行。  

在学校你一直都只要对自己的代码负责，自己玩自个儿的，是很难体会到“高内聚，低耦合”是啥意思，也体会不到为啥要这么做。  

出来工作后，开始要code review别人的代码了，才渐渐体会到为什么要“高内聚，低耦合”。  

前些天review同事的代码，明明记得产品上他这个方法里应该还有一个分支，但是没看到，我就跑去问：前几天不是在这块添加了一个情况嘛，这次你改这块，怎么没见前几天要改的那种情况？  

他回：哦，前几天加这逻辑时，我给加到外面调用的地方去了。  

我：。。。。。。那情况不应该加到你这方法里来一起做更合适嘛，你扔外面，谁能给你review到...我还以为你忘了呢。  

所以“高内聚，低耦合”应该给我们如下指导：
1. 迭代代码时，不能只考虑功能的实现，更应该考虑代码位置的合理性，应该把你的代码加在合适的地方。
2. 合适的地方？
	- 可以从表的角度来考虑，比如对A表进行操作，那跟A表有关的逻辑判断就应该尽量放在一起，而不是这修改一次A表，十万八千里的某个地方再修改一次A表。
	- 可以从业务模块的角度考虑，比如这块对权限的判断，这块是对角色的判断，这块是客户模块的操作，这块是非核心的日志模块操作。
3. 低耦合，要求我们迭代代码是，尽量少的复制粘贴别人的代码，哪怕是只有一行的代码。  
	如果你要复制别人的private方法，那你应该将这个private方法改写成public，变成一个可调用的服务或者工具类。  
	别人第一次写这个方法时，他很难判断出，这个private方法以后是否会被复用到，所以，他写成private是合理的，你再迭代时，用到了这个private里的逻辑，那你就应该改写方法可见性，而不是复制这个代码到你要用的地方。  
	**低耦合的神器就是方法的重载。**

# java8

java8的stream api爽的真的让我欲罢不能。但是要想优雅的使用，也是要不断的自我反省，学习，提高的。

1. 一个流操作独占一行。
	如果你一股脑都写一行，那报错时你就懵了，根本不知道哪个操作NPE了...
	```java
		// 不推荐
		list.stream().filter(...).map(..).collect(...);
		// 推荐
		list.stream().
			.filter(...)
			.map(...)
			.collect(...);
	```

2. lambda应该是帮助你优雅的表达出业务逻辑的。如果你的lambda本身就不优雅，请优化成优雅的，要不就干脆别用。
	```java
	// 不优雅-1： 无脑foreach，然后在foreach里写大段大段代码
	// 应该看看foreach里的东西能不能用其他stream api抽一些出来，
	// 然后把foreach里的代码抽成一个private方法，取一个恰当的名字。
	list.foreach(i -> {
		// 20-30行业务代码
	})
	// 不优雅-2： map里写大段大段代码
	// 应该把map里的代码抽成一个私有方法，取一个可以表达这段代码的意思的方法名
	list.stream()
		.map(i -> {
			// 一堆代码
		})
		.filter(...)
		.collect(...);
	```

3. 注意api的学习  
	比如java中map的value是可以为null的，但是在`collect(Collectors.toMap(User::getId, User::getName))`将list转为map时，就要求User对象的id和name都不能为null。
	平时多使用，多测试，多积累。

4. 尝试使用函数式编程，减少系统中的重复代码。  
	如果系统中有两段极为相似的代码，仅仅只是某个对象调用的方法不同，那你可以试着把这个方法做为入参，将两段代码复用了。
	